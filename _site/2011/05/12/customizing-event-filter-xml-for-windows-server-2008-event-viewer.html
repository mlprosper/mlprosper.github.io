<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Customizing event filter xml for Windows Server 2008 Event Viewer</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">I, Prosper</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Customizing event filter xml for Windows Server 2008 Event Viewer</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-12T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content">Lately I've been trying to diagnose a couple of ASP.Net connection errors on our Windows Server 2008 machine.  The error would happen sporadically and I could not reproduce it locally.  In the Windows Event Viewer the xml for each event would look something like this:<code></code>

<code>&lt;Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event"&gt;</code>

<code>&lt;System&gt;
&lt;Provider Name="ASP.NET 2.0.50727.0" /&gt;
&lt;EventID Qualifiers="32768"&gt;1309&lt;/EventID&gt;
&lt;Level&gt;3&lt;/Level&gt;
&lt;Task&gt;3&lt;/Task&gt;
&lt;Keywords&gt;0x80000000000000&lt;/Keywords&gt;
&lt;TimeCreated SystemTime="2011-04-25T15:45:13.000Z" /&gt;
&lt;EventRecordID&gt;21758&lt;/EventRecordID&gt;
&lt;Channel&gt;Application&lt;/Channel&gt;
&lt;Computer&gt;DED432&lt;/Computer&gt;
&lt;Security /&gt;
&lt;/System&gt;</code>

<code>&lt;EventData&gt;
&lt;Data&gt;3005&lt;/Data&gt;
&lt;Data&gt;An unhandled exception has occurred.&lt;/Data&gt;
&lt;Data&gt;4/25/2011 8:45:13 AM&lt;/Data&gt;
&lt;Data&gt;4/25/2011 3:45:13 PM&lt;/Data&gt;
&lt;/EventData&gt;
&lt;/Event&gt;
</code>

<code></code>I wanted to create a custom Filter on the first "Data" node of the "EventData" node so I could see how often the error occured.  To create a custom filter, I clicked on "Filter Current Log":

<a href="http://mlprosper.files.wordpress.com/2011/05/eventvieweroptiosn.png"><img class="alignnone size-full wp-image-105" title="eventvieweroptiosn" src="http://mlprosper.files.wordpress.com/2011/05/eventvieweroptiosn.png" alt="" width="364" height="363" /></a>

There wasn't an option to filter on any of the data in the "EventData" node, so I clicked the XML tab, unchecked the "Edit query manually" box and said Yes to the dialog:

<a href="http://mlprosper.files.wordpress.com/2011/05/eventviewerxml.png"><img class="alignnone size-full wp-image-106" title="eventviewerxml" src="http://mlprosper.files.wordpress.com/2011/05/eventviewerxml.png" alt="" width="539" height="543" /></a>

After some searching, here is the xml to filter on the "Data" nodes in "EventData":<code></code>

&lt;QueryList&gt;
&lt;Query Id="0" Path="Application"&gt;
&lt;Select Path="Application"&gt;*[System[(Level=3) and (EventID=1309)]] and *[EventData[Data[1]='3005']]&lt;/Select&gt;
&lt;/Query&gt;
&lt;/QueryList&gt;

Turns out the data is stored in an array and can be accessed with an ordinal (e.g. "Data[1]").
</div>


  <footer>
    <p class="meta">
      
  



      








  


<time datetime="2011-05-12T00:00:00-07:00" pubdate data-updated="true"></time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2011/05/10/textmate-bundles-for-haml-sass-etc.html" title="Previous Post: TextMate bundles for HAML, SASS, etc.">&laquo; TextMate bundles for HAML, SASS, etc.</a>
      
      
        <a class="basic-alignment right" href="/2011/11/29/generating-an-ssl-cert-for-amazon-elb.html" title="Next Post: Generating an SSL cert for Amazon ELB">Generating an SSL cert for Amazon ELB &raquo;</a>
      
    </p>
  </footer>
</article>

</div>



          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
