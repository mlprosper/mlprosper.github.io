<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Using ELMAH with ASP.Net and MySQL</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Using ELMAH with ASP.Net and MySQL</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-29T00:00:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I’ve been trying to use ELMAH (http://code.google.com/p/elmah/) as a quick-and-dirty logging solution for an ASP.Net project I’ve been working on. The installation went smoothly until I actually logged the first error. The Elmah.axd page would crash with an error when trying to view a logged error:</p>

<p>“There is an unclosed literal string”</p>

<p>After some looking, I actually dove into the MySQL table to find the cause. Apparently some ASP.Net pages contain too much text to be stored in the AllXml column of the “elmah<em>error” table in a MySQL backed application. The only solution is to change the AllXml column type to “LONGTEXT”, then change the “elmah</em>LogError” procedure so that the IN parameter is also LONGTEXT. Here is the procedure below:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="err">—</span> <span class="err">—————————————————————————</span>
<span class="err">—</span> <span class="k">Routine</span> <span class="n">DDL</span>
<span class="err">—</span> <span class="n">Note</span><span class="p">:</span> <span class="n">comments</span> <span class="k">before</span> <span class="k">and</span> <span class="k">after</span> <span class="n">the</span> <span class="k">routine</span> <span class="n">body</span> <span class="n">will</span> <span class="k">not</span> <span class="n">be</span> <span class="n">stored</span> <span class="k">by</span> <span class="n">the</span> <span class="n">server</span>
<span class="err">—</span> <span class="err">—————————————————————————</span><span class="o">-</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>

<span class="k">CREATE</span> <span class="k">DEFINER</span><span class="o">=`</span><span class="n">yourusername</span><span class="o">`@`%`</span> <span class="k">PROCEDURE</span> <span class="o">`</span><span class="n">elmah_LogError</span><span class="o">`</span><span class="p">(</span>
    <span class="k">IN</span> <span class="n">ErrorId</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span>
    <span class="k">IN</span> <span class="n">Application</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
    <span class="k">IN</span> <span class="k">Host</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="k">IN</span> <span class="k">Type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">IN</span> <span class="k">Source</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
    <span class="k">IN</span> <span class="n">Message</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="k">IN</span> <span class="k">User</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="k">IN</span> <span class="n">AllXml</span> <span class="n">LONGTEXT</span><span class="p">,</span>
    <span class="k">IN</span> <span class="n">StatusCode</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="k">IN</span> <span class="n">TimeUtc</span> <span class="n">DATETIME</span>
<span class="p">)</span>

<span class="k">MODIFIES</span> <span class="k">SQL</span> <span class="k">DATA</span>

<span class="k">BEGIN</span>

    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">elmah_error</span><span class="o">`</span> <span class="p">(</span>
        <span class="o">`</span><span class="n">ErrorId</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="n">Application</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="k">Host</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="k">Type</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="k">Source</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="n">Message</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="k">User</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="n">AllXml</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="n">StatusCode</span><span class="o">`</span><span class="p">,</span>
        <span class="o">`</span><span class="n">TimeUtc</span><span class="o">`</span>
    <span class="p">)</span>
    <span class="k">VALUES</span> <span class="p">(</span>
        <span class="n">ErrorId</span><span class="p">,</span>
        <span class="n">Application</span><span class="p">,</span>
        <span class="k">Host</span><span class="p">,</span>
        <span class="k">Type</span><span class="p">,</span>
        <span class="k">Source</span><span class="p">,</span>
        <span class="n">Message</span><span class="p">,</span>
        <span class="k">User</span><span class="p">,</span>
        <span class="n">AllXml</span><span class="p">,</span>
        <span class="n">StatusCode</span><span class="p">,</span>
        <span class="n">TimeUtc</span>
    <span class="p">);</span>

<span class="k">END</span>
</code></pre></div>
<p>Changing the column type is easy:
<code>sql
ALTER TABLE elmah_error modify AllXml LONGTEXT ;
</code></p>

<p>Here’s a link to a related issue on the ELMAH site: <a href="http://code.google.com/p/elmah/issues/detail?id=248">http://code.google.com/p/elmah/issues/detail?id=248</a></p>
</div>


  <footer>
    <p class="meta">
      
  



      








  


<time datetime="2011-12-29T00:00:00-08:00" pubdate data-updated="true"></time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2011/11/29/visual-studio-2010-and-web-deploy-acls.html" title="Previous Post: Visual Studio 2010 and Web Deploy ACLs">&laquo; Visual Studio 2010 and Web Deploy ACLs</a>
      
      
        <a class="basic-alignment right" href="/2012/02/15/web-farm-framework-and-amazon-ec2.html" title="Next Post: Web Farm Framework and Amazon EC2">Web Farm Framework and Amazon EC2 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>



          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
